<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOTM 2022 Workshop - OSM for sustainable transport planning: getting started • openinfra</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SOTM 2022 Workshop - OSM for sustainable transport planning: getting started">
<meta property="og:description" content="openinfra">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">openinfra</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/openinfra.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/QGIS_OSM_Setup.html">Getting and using OSM data with GUI QGIS</a>
    </li>
    <li>
      <a href="../articles/SOTM_workshop.html">SOTM 2022 Workshop - OSM for sustainable transport planning: getting started</a>
    </li>
    <li>
      <a href="../articles/data_packs.html">Transport Infrastructure Data Packs</a>
    </li>
    <li>
      <a href="../articles/getosm.html">Getting and using OSM data with the R package osmextract</a>
    </li>
    <li>
      <a href="../articles/im_get.html">Function and documentation for Inclusive Mobility guide (2021)</a>
    </li>
    <li>
      <a href="../articles/osm-python.html">Getting and using osm data in Python</a>
    </li>
    <li>
      <a href="../articles/package_networks.html">Network definitions (pre-defined networks) by OSM data package</a>
    </li>
    <li>
      <a href="../articles/regions.html">Transport regions in the UK</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/udsleeds/openinfra/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>SOTM 2022 Workshop - OSM for sustainable transport planning: getting started</h1>
                        <h4 data-toc-skip class="author">James Hulse, Greta Timaite, Robin Lovelace</h4>
            
            <h4 data-toc-skip class="date">2022-08-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/udsleeds/openinfra/blob/HEAD/vignettes/SOTM_workshop.Rmd" class="external-link"><code>vignettes/SOTM_workshop.Rmd</code></a></small>
      <div class="hidden name"><code>SOTM_workshop.Rmd</code></div>

    </div>

    
    
<p>The <a href="https://2022.stateofthemap.org/sessions/JEXYHK/" class="external-link">workshop</a> is aimed at everyone interested in using OpenStreetMap (OSM) to support sustainable transport planning, in professional or advocacy contexts. It demonstrates how to get started with using OSM data representing transport infrastructure for sustainable transport planning, research and policy-making. It covers how to identify, re-categorize, visualize, and analyze key tags that represent walking, cycling, and wheeling networks. We also discuss OSM data in the context of other data sources to identify its advantages and limitations.</p>
<p>The workshop is practical and covers the following questions:</p>
<ol style="list-style-type: decimal">
<li>What gaps in transport evidence can OSM data fill in different countries?</li>
<li>Which elements and tags are most important for transport planning (and how to get the data in reproducible data science environments)?</li>
<li>How to filter based on different tags and their values?</li>
<li>How to use OSM datasets to visualize transport systems in static and interactive maps?</li>
<li>How to add value to OSM data and communicate results using R, Python and A/B Street, and osm2streets?</li>
</ol>
<p>To get the most out of the workshop, we recommend installing R, RStudio, and the required packages before the session. To do this, follow “Installation” section below. To make sure that everything is installed correctly, run the code in the “Installation Check” section below. Check <a href="https://github.com/udsleeds/openinfra/issues/98" class="external-link">issue 98 on the udsleeds/openinfra repo on GitHub</a> (you will need an account to comment) to see what you should get after running that code. Let us know if you have not :)</p>
<p>This workshop assumes no any prior knowledge of R. We recommend taking a look at online resources like <a href="https://education.rstudio.com/learn/beginner/" class="external-link">RStudio’s Beginners guide</a> and its <a href="https://www.rstudio.com/resources/webinars/a-gentle-introduction-to-tidy-statistics-in-r/" class="external-link">Gentle Introduction to Tidy Statistics in R</a> if you’re new to the language, however.</p>
<!--
This workshop covers: 
* How to download and get OSM data from the R package `osmextract`
* Basics on how the `osmextract` package works
* How to visualise different types of network infrastructure
* How to add value to OSM infrastructure data through the `openinfra` package 
-->
<div class="section level2">
<h2 id="preparation">Preparation<a class="anchor" aria-label="anchor" href="#preparation"></a>
</h2>
<div class="section level3">
<h3 id="installing-r-and-rstudio">Installing R and RStudio<a class="anchor" aria-label="anchor" href="#installing-r-and-rstudio"></a>
</h3>
<p>In this workshop we’ll use R, a statistical programming language widely used for data science, modelling and visualisation. If you are new to R, you should install base R and RStudio before the workshop begins. <br> There is a great <a href="https://rstudio-education.github.io/hopr/starting.html" class="external-link">R and RStudio installation guide</a> (Section A.1) by Garrett Grolemund, within <a href="https://rstudio-education.github.io/hopr/" class="external-link">Hands-On Programming with R</a> for Windows, Mac, and Linux devices.</p>
</div>
<div class="section level3">
<h3 id="installing-packages">Installing packages<a class="anchor" aria-label="anchor" href="#installing-packages"></a>
</h3>
<p>A number of packages will be used within this workshop, though namely <a href="https://github.com/ropensci/osmextract" class="external-link"><code>osmextract</code></a> and <a href="https://github.com/udsleeds/openinfra" class="external-link">openinfra</a>.</p>
<p>Here are some of the additional packages we will make use of within this workshop:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkgs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"tmap"</span>,    <span class="co"># package for map making</span></span>
<span>  <span class="st">"sf"</span>,      <span class="co"># geographic vector data classes and functions</span></span>
<span>  <span class="st">"dplyr"</span>,   <span class="co"># data manipulation</span></span>
<span>  <span class="st">"remotes"</span>  <span class="co"># for installing packages from GitHub</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>These can be installed with the following command:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">pkgs</span>, repos <span class="op">=</span> <span class="st">"http://cran.us.r-project.org"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>You can install additional packages, including the development versions of the <code>osmextract</code> and <code>openinfra</code> packages as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"mapedit"</span><span class="op">)</span></span>
<span><span class="co"># Enter the lines below into your console to install!</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ropensci/osmextract"</span>, force <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"udsleeds/openinfra"</span><span class="op">)</span></span></code></pre></div>
<p>Each package can then be loaded one-by-one as follows:<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmextract/" class="external-link">osmextract</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/udsleeds/openinfra/" class="external-link">openinfra</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="installation-check">Installation check<a class="anchor" aria-label="anchor" href="#installation-check"></a>
</h3>
<p>If installation has occurred correctly, running the code below locally (on your own device) should successfully create two plots: <br> One 5km radius circular buffer of the infrastructure network around Leeds (UK) City Centre, and <br> Secondly, a test plot just outside of the Institute of Transport Studies (ITS), at the University of Leeds.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Pre-installed package data for central Leeds</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="fu">openinfra</span><span class="fu">::</span><span class="va"><a href="../reference/sotm_data.html">sotm_data</a></span></span>
<span><span class="co"># Test osmextract file (ITS Leeds = Institute of Transport Studies, University of Leeds)</span></span>
<span><span class="va">test_data</span> <span class="op">=</span> <span class="fu">osmextract</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmextract/reference/oe_get.html" class="external-link">oe_get</a></span><span class="op">(</span>place <span class="op">=</span> <span class="st">"ITS Leeds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot central Leeds</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"highway"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"highway"</span>, title.col <span class="op">=</span> <span class="st">"OSM Highways"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span> legend.bg.alpha <span class="op">=</span> <span class="fl">0.5</span>, legend.bg.color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot ITS</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">test_data</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"highway"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"highway"</span>, title.col <span class="op">=</span> <span class="st">"OSM Highways"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span> legend.bg.alpha <span class="op">=</span> <span class="fl">0.5</span>, legend.bg.color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p>To check that your plots match, check <a href="https://github.com/udsleeds/openinfra/issues/98" class="external-link">issue 98</a></p>
</div>
<div class="section level3">
<h3 id="installing-packages-and-install-check-in-one">Installing packages and install check in one<a class="anchor" aria-label="anchor" href="#installing-packages-and-install-check-in-one"></a>
</h3>
<p>If you already have <a href="https://cran.rstudio.com/" class="external-link">base r</a> &amp; <a href="https://www.rstudio.com/products/rstudio/download/#download" class="external-link">Rstudio</a> installed, you can perform the package installations and run the installation check in one by copy and pasting the code cell below into your rstudio and hitting <code>crtl + enter</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkgs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"tmap"</span>,    <span class="co"># package for map making</span></span>
<span>  <span class="st">"sf"</span>,      <span class="co"># geographic vector data classes and functions</span></span>
<span>  <span class="st">"dplyr"</span>,   <span class="co"># data manipulation</span></span>
<span>  <span class="st">"remotes"</span>, <span class="co"># for installing packages from GitHub</span></span>
<span>  <span class="st">"tidyverse"</span>,</span>
<span>  <span class="st">"mapedit"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">pkgs</span>, repos <span class="op">=</span> <span class="st">"http://cran.us.r-project.org"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ropensci/osmextract"</span>, force <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"udsleeds/openinfra"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmextract/" class="external-link">osmextract</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/udsleeds/openinfra/" class="external-link">openinfra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pre-installed package data for central Leeds</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="fu">openinfra</span><span class="fu">::</span><span class="va"><a href="../reference/sotm_data.html">sotm_data</a></span></span>
<span><span class="co"># Test osmextract file (ITS Leeds = Institute of Transport Studies, University of Leeds)</span></span>
<span><span class="va">test_data</span> <span class="op">=</span> <span class="fu">osmextract</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmextract/reference/oe_get.html" class="external-link">oe_get</a></span><span class="op">(</span>place <span class="op">=</span> <span class="st">"ITS Leeds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot central Leeds</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"highway"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"highway"</span>, title.col <span class="op">=</span> <span class="st">"OSM Highways"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span> legend.bg.alpha <span class="op">=</span> <span class="fl">0.5</span>, legend.bg.color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot ITS</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">test_data</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"highway"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"highway"</span>, title.col <span class="op">=</span> <span class="st">"OSM Highways"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span> legend.bg.alpha <span class="op">=</span> <span class="fl">0.5</span>, legend.bg.color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="why-these-packages">Why these packages?<a class="anchor" aria-label="anchor" href="#why-these-packages"></a>
</h3>
<p>The <a href="https://github.com/ropensci/osmextract" class="external-link"><code>osmextract</code></a> package is an open source package for downloading and importing large OSM ‘extracts’ from providers who make the datasets available at national and regional levels. We can view all <code>osmextract</code> available providers with the following:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">osmextract</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmextract/reference/oe_providers.html" class="external-link">oe_providers</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><br><code>osmextract</code> can currently import datasets from the following providers: <a href="http://download.geofabrik.de/" class="external-link">Geofabrik</a>, <a href="https://download.bbbike.org/osm/" class="external-link">BBBike</a>, and <a href="https://download.openstreetmap.fr/extracts/" class="external-link">openstreetmap_fr</a>. These provide OSM datasets in the pbf file format .pbf, which is optimized for small file sizes (see the <a href="https://wiki.openstreetmap.org/wiki/PBF_Format" class="external-link">OSM wiki</a> for details). <br><br> The <a href="https://github.com/udsleeds/openinfra" class="external-link">openinfra</a> package, contains several functions to re-categorize OSM infrastructure data from the default key=tag values to friendlier visuals.</p>
<p><a href="https://r-tmap.github.io/tmap/index.html" class="external-link"><code>tmap</code></a> is a fantastic package for visualizing geospatial data either statically or interactively.</p>
<p>The <a href="https://r-spatial.github.io/sf/" class="external-link"><code>sf</code> package</a> supports the representation of spatial vector data as simple features which, consequentially, makes spatial analysis much more accessible. This package is a backbone of geographic vector data in R and the code in this workshop :)</p>
</div>
</div>
<div class="section level2">
<h2 id="openinfra-data-packs">OpenInfra data packs<a class="anchor" aria-label="anchor" href="#openinfra-data-packs"></a>
</h2>
<p>A key output of the project is open access active travel data packs. These will be released in the Releases section of the udsleeds/openinfra repo: <a href="https://github.com/udsleeds/openinfra/releases" class="external-link uri">https://github.com/udsleeds/openinfra/releases</a></p>
<p>Let’s dive straight in and load some data:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">u</span> <span class="op">=</span> <span class="st">"https://github.com/udsleeds/openinfra/releases/download/v0.2/datapack_leeds.geojson"</span></span>
<span><span class="va">openinfra_data</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span></span></code></pre></div>
<p>Task: plot and do basic analysis of this dataset.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">u</span> <span class="op">=</span> <span class="st">"https://github.com/udsleeds/openinfra/releases/download/0.3/datapack_leeds.zip"</span></span>
<span><span class="va">f</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">u</span>, destfile <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="importing-osm-data">Importing OSM data<a class="anchor" aria-label="anchor" href="#importing-osm-data"></a>
</h2>
<p>In this section we will use <code>osmextract</code> to download OSM data that will be used throughout this workshop.</p>
<p>The <code>osmextract</code> package comprises the following core functions (also see a <a href="https://docs.ropensci.org/osmextract/articles/osmextract.html?q=file%20path#main-package-functions" class="external-link">vignette introducing <code>osmextract</code></a>):</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th align="center">Function</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><code><a href="https://docs.ropensci.org/osmextract/reference/oe_providers.html" class="external-link">oe_providers()</a></code></td>
<td>Shows a data frame of currently supported OSM data providers</td>
</tr>
<tr class="even">
<td align="center"><code><a href="https://docs.ropensci.org/osmextract/reference/oe_match.html" class="external-link">oe_match()</a></code></td>
<td>Matches the input place query with a url from one of the OSM providers</td>
</tr>
<tr class="odd">
<td align="center"><code><a href="https://docs.ropensci.org/osmextract/reference/oe_download.html" class="external-link">oe_download()</a></code></td>
<td>Downloads data from OSM providers</td>
</tr>
<tr class="even">
<td align="center"><code><a href="https://docs.ropensci.org/osmextract/reference/oe_vectortranslate.html" class="external-link">oe_vectortranslate()</a></code></td>
<td>Converts between .pbf (providers default) and .gpkg file formats</td>
</tr>
<tr class="odd">
<td align="center"><code><a href="https://docs.ropensci.org/osmextract/reference/oe_read.html" class="external-link">oe_read()</a></code></td>
<td>Reads downloaded .pbf and .gpk files into R</td>
</tr>
<tr class="even">
<td align="center"><code><a href="https://docs.ropensci.org/osmextract/reference/oe_get.html" class="external-link">oe_get()</a></code></td>
<td>Performs all of the above in a single function</td>
</tr>
</tbody>
</table>
<p>To start off we will use a generic <code><a href="https://docs.ropensci.org/osmextract/reference/oe_get.html" class="external-link">oe_get()</a></code> function to download data for Leeds, UK. It might take a while. If you struggle downloading the data or it takes long to compute, then you might use the example dataset (e.g. <code><a href="../reference/sotm_data.html">openinfra::sotm_data</a></code>) for central Leeds. This is a much smaller dataset, thus making computing much quicker.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A useful function is `oe_match_pattern()` to search for patterns in a provider's database. It is helpful in indicating a correct region name for a given provider.</span></span>
<span><span class="fu">osmextract</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmextract/reference/oe_match_pattern.html" class="external-link">oe_match_pattern</a></span><span class="op">(</span><span class="st">"Leeds"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">leeds</span> <span class="op">=</span> <span class="fu">osmextract</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmextract/reference/oe_get.html" class="external-link">oe_get</a></span><span class="op">(</span></span>
<span>  place <span class="op">=</span> <span class="st">"Leeds"</span>, </span>
<span>  provider <span class="op">=</span> <span class="st">"bbbike"</span>, <span class="co"># Indicates the provider; default is geofabrik</span></span>
<span>  layer <span class="op">=</span> <span class="st">"lines"</span> <span class="co"># Default; returns linestring geometries (highways etc) </span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># have a look at the data</span></span>
<span><span class="va">leeds</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>See the documentation associated with <code><a href="https://docs.ropensci.org/osmextract/reference/oe_get.html" class="external-link">oe_get()</a></code> on the package website or by entering the command <code><a href="https://docs.ropensci.org/osmextract/reference/oe_get.html" class="external-link">?oe_get</a></code> into the R console.</p>
<div class="section level3">
<h3 id="tags">Tags<a class="anchor" aria-label="anchor" href="#tags"></a>
</h3>
<p>In the previous example we’ve downloaded OSM data but it does not necessarily contain all the information we need (unless you used the example <code>sotm_data</code>). Indeed, it only has 10 columns and only <code>highway</code> column is directly useful for active travel infrastructure planning!</p>
<p>To get additional tags we need to specify this as an additional argument before running <code><a href="https://docs.ropensci.org/osmextract/reference/oe_get.html" class="external-link">oe_get()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># so let's define the extra tags we want</span></span>
<span></span>
<span><span class="va">et</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kerb"</span>, <span class="st">"width"</span>, <span class="st">"sidewalk"</span>, <span class="st">"cycleway"</span>, <span class="st">"footway"</span>, <span class="st">"lit"</span>, <span class="st">"wheelchair"</span>,</span>
<span>       <span class="st">"maxspeed"</span>, <span class="st">"foot"</span>, <span class="st">"access"</span>, <span class="st">"service"</span>, <span class="st">"bicycle"</span>, <span class="st">"oneway"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">leeds</span> <span class="op">=</span> <span class="fu">osmextract</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmextract/reference/oe_get.html" class="external-link">oe_get</a></span><span class="op">(</span></span>
<span>  place <span class="op">=</span> <span class="st">"Leeds"</span>, </span>
<span>  provider <span class="op">=</span> <span class="st">"bbbike"</span>,</span>
<span>  layer <span class="op">=</span> <span class="st">"lines"</span>,</span>
<span>  extra_tags <span class="op">=</span> <span class="va">et</span> <span class="co"># non-default tags to download</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># have a look at the data</span></span>
<span><span class="va">leeds</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># also it's useful to have a look at the downloaded data by plotting it</span></span>
<span><span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">leeds</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="st">"highway"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"highway"</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://user-images.githubusercontent.com/58815827/185735455-78849abc-ec98-4597-b079-b3874008ebf9.png"></p>
<p>Strangely (or not!) our Leeds data actually represents the whole of West Yorkshire and not only Leeds as we requested.</p>
<pre><code><span><span class="co"># also it's useful to have a look at the downloaded data by plotting it </span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">leeds</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="st">"highway"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"highway"</span> <span class="op">)</span></span></code></pre>
<p>The Leeds data actually represents the whole of West Yorkshire and not only Leeds as we requested. This is because BBBike only provides results for rectangular datasets. To refine this network further we can apply spatial subsetting.</p>
</div>
<div class="section level3">
<h3 id="defining-your-own-area-optional">Defining your own area (optional)<a class="anchor" aria-label="anchor" href="#defining-your-own-area-optional"></a>
</h3>
<p>You can subset the downloaded datasets using <code>mapview</code> and <code>mapedit</code> packages (which you need to have installed if you run this section) to manually define an area, get its coordinates to perform spatial subsetting.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_leeds</span> <span class="op">=</span> <span class="fu">mapview</span><span class="fu">::</span><span class="fu">mapview</span><span class="op">(</span><span class="va">leeds</span><span class="op">)</span> <span class="co"># create an object containing interactive map  </span></span>
<span><span class="va">map_leeds_edit</span> <span class="op">=</span> <span class="fu">mapedit</span><span class="fu">::</span><span class="fu">editMap</span><span class="op">(</span><span class="va">map_leeds</span><span class="op">)</span> <span class="co"># use `mapedit` package to draw a new polygon</span></span>
<span><span class="va">box</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">map_leeds_edit</span><span class="op">$</span><span class="va">drawn</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span> <span class="co"># extract the coordinates of a new polygon</span></span>
<span><span class="va">box</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="getting-data-with-osmdata-optional">Getting data with <code>osmdata</code> (optional)<a class="anchor" aria-label="anchor" href="#getting-data-with-osmdata-optional"></a>
</h3>
<p>Another package for getting OSM data is <code>osmdata</code>, which gets data from the Overpass API rather than from bulk .pbf files. <code>osmdata</code> is ideal for getting small amounts of data from OSM, e.g. the boundary representing Leeds, as shown in the code chunk below (you need to have the <code>osmdata</code> package installed to run this).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leeds_boundary</span> <span class="op">=</span> <span class="fu">osmdata</span><span class="fu">::</span><span class="fu">getbb</span><span class="op">(</span><span class="st">"Leeds"</span>, format_out <span class="op">=</span> <span class="st">"sf_polygon"</span>, limit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/qtm.html" class="external-link">qtm</a></span><span class="op">(</span><span class="va">leeds_boundary</span><span class="op">)</span></span></code></pre></div>
<p>After running the lines of code above you should see the following which is the boundary for Leeds:</p>
<p><img src="https://user-images.githubusercontent.com/1825120/185735290-1cbc8b8c-b0f9-4647-b66d-87801ab0d315.png"></p>
<p><strong>Task</strong>: try get the boundary for Florence (Firenze in Italian) using the same technique.</p>
<p><img src="https://user-images.githubusercontent.com/1825120/185735464-141a7a5f-482e-42ac-a5db-85f415a9e68c.png"></p>
</div>
<div class="section level3">
<h3 id="getting-a-boundary-with-a-buffer">Getting a boundary with a buffer<a class="anchor" aria-label="anchor" href="#getting-a-boundary-with-a-buffer"></a>
</h3>
<p>Let’s get everything within a 2.5 km radius of central Leeds, which has coordinates of -1.549, 53.801:<br> You can change the size of the circular buffer by altering the <code>dist</code> parameter (metres)</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leeds_centre_point</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.549</span>, <span class="fl">53.801</span><span class="op">)</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span></span>
<span><span class="va">leeds_buffer</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="va">leeds_centre_point</span>, dist <span class="op">=</span> <span class="fl">2500</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="spatial-subsetting">Spatial subsetting<a class="anchor" aria-label="anchor" href="#spatial-subsetting"></a>
</h3>
<p>Next we will subset Leeds city from <code>leeds</code> dataset. Spatial subsetting is one of the essential operations in geocomputation, so if you want to learn more about this, check out <a href="https://geocompr.robinlovelace.net/spatial-operations.html#spatial-subsetting" class="external-link">“Spatial subsetting”</a> section in the Geocomputation with R (Lovelace et al., 2022).</p>
<p>Now we have coordinates of an area we are interested in. From here on there are two ways for getting OSM data for that. One is to use <code><a href="https://docs.ropensci.org/osmextract/reference/oe_get.html" class="external-link">oe_get()</a></code> again and give it an additional <code>boundary</code> and <code>boundary_type</code> arguments.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leeds_defined</span> <span class="op">=</span> <span class="fu">osmextract</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmextract/reference/oe_get.html" class="external-link">oe_get</a></span><span class="op">(</span></span>
<span>  place <span class="op">=</span> <span class="st">"Leeds"</span>, </span>
<span>  provider <span class="op">=</span> <span class="st">"bbbike"</span>, </span>
<span>  layer <span class="op">=</span> <span class="st">"lines"</span>, </span>
<span>  extra_tags <span class="op">=</span> <span class="va">et</span>,</span>
<span>  boundary <span class="op">=</span> <span class="va">leeds_buffer</span>,</span>
<span>  boundary_type <span class="op">=</span> <span class="st">"clipsrc"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, we can subset the <code>leeds</code> data, so we do not have to download data again.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leeds_defined2</span> <span class="op">=</span> <span class="va">leeds</span><span class="op">[</span><span class="va">leeds_buffer</span>, op <span class="op">=</span> <span class="va">st_within</span><span class="op">]</span> </span></code></pre></div>
<p>You can plot this as follows:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">leeds_defined2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://user-images.githubusercontent.com/58815827/185736112-b62d03dc-e827-4dda-a818-cc0f57ad32ca.png"></p>
<p><strong>Task</strong>:</p>
<ol style="list-style-type: decimal">
<li>Decide which tags you would like to download (be selective!)</li>
<li>Download OSM data for a place of your choice by modifying the code above.</li>
<li>Bonus: subset your dataset and plot it.</li>
</ol>
<p>Note: not every city/town/region might be directly queried using osmextract.</p>
</div>
</div>
<div class="section level2">
<h2 id="data-exploration">Data exploration<a class="anchor" aria-label="anchor" href="#data-exploration"></a>
</h2>
<p>As alluded in the previous section, it is important to understand the data before using it for further (spatial) analysis or inform decision-making.</p>
<p>In this section you will be introduced to data filtering based on OSM tags and how to visualise them.</p>
<div class="section level3">
<h3 id="data-filtering">Data filtering<a class="anchor" aria-label="anchor" href="#data-filtering"></a>
</h3>
<p>Our data contains a lot of information, but not all of it might be needed. For example, active travel includes cycling, walking, and wheeling, but you may only be interested in cycling. In this case it would be reasonable to contain only data that is related to cycling. In other words, we may not need data on waterways or motorways as one cannot cycle on them.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter out all the rows that do not contain highways</span></span>
<span><span class="va">leeds_highways</span> <span class="op">=</span> <span class="va">leeds_defined2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">highway</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Our data now only contains highways in Leeds, but we want to create a new dataset containing highway=cycleway only and then visualise them by plotting on a map.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter and select</span></span>
<span><span class="va">leeds_cycleway</span> <span class="op">=</span> <span class="va">leeds_highways</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"cycleway"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># filtering based on a key value</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">highway</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="va">leeds_cycleway</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://user-images.githubusercontent.com/58815827/185743244-6878f164-31b5-4b63-89af-ddbd3b352ba9.png"></p>
<p>Of course, highway=cycleway does not represent an entire cycling infrastructure in the given region. For this we need to apply more complex (conditional) filtering to our data.</p>
<p>For example, you may know that it is illegal to cycle on certain roads, such as motorways in the UK. Also, it may be a case that a cycleway is not mapped separately but, rather, has been tagged as part of another highway, such as tertiary road, using <code>bicycle=*</code> tag.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># To filter data based on these requirements we will:</span></span>
<span></span>
<span><span class="va">leeds_cycle</span> <span class="op">=</span> <span class="va">leeds_highways</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">highway</span> <span class="op">==</span> <span class="st">"cycleway"</span> <span class="op">|</span></span>
<span>                <span class="va">bicycle</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'yes'</span><span class="op">)</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># let's plot our new cycle network</span></span>
<span><span class="va">leeds_cycle</span><span class="op">[</span><span class="st">"geometry"</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://user-images.githubusercontent.com/58815827/185743279-6fdad122-4b59-43ed-ae4b-c8231ddceff7.png"></p>
<p><strong>Task</strong>:</p>
<ol style="list-style-type: decimal">
<li>Think what other tags and/or their values might be useful to define cycling network. Use them to further refine the network and plot it.</li>
<li>Do you think your new network accurately represents the existing network?</li>
<li>What do you think are potential challenges in defining a network? (eg. missing data)</li>
<li>Bonus: try to define a pedestrian network.</li>
</ol>
</div>
<div class="section level3">
<h3 id="pre-defined-networks">Pre-defined networks<a class="anchor" aria-label="anchor" href="#pre-defined-networks"></a>
</h3>
<p>It’s not easy to define a network and, once conceptualised, a lack of data might still lead to innacurate representation, thus limiting further analysis and application.</p>
<p>Nevertheless, it’s still useful to have a network defined. For instance, <code>osmextract</code> does offer an opportunity to download pre-defined walking, cycling, or driving networks. Yet, if you choose to do this, do check the code used to create the network to ensure that you understand how the network has been defined and that it works for your needs.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># to download cycling network as defined by `osmextract`</span></span>
<span><span class="va">osme_cycle</span> <span class="op">=</span> <span class="fu">osmextract</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmextract/reference/oe_get_network.html" class="external-link">oe_get_network</a></span><span class="op">(</span>place <span class="op">=</span> <span class="st">"Leeds"</span>,</span>
<span>                                        mode <span class="op">=</span> <span class="st">"cycling"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot cycling network</span></span>
<span><span class="va">osme_cycle</span><span class="op">[</span><span class="st">"geometry"</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="visualisation">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation"></a>
</h2>
<p>In this workshop we’ve been visualizing our data to improve our understanding. Up to this point we’ve been visualising data statically using base R <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function. However, there is a powerful <code>tmap</code> library that can be used to create static and interactive plots to communicate your findings.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># equivalent to the earlier plotted map</span></span>
<span><span class="co"># Note: it might be useful to store your plot as a tmap object that can be called at any point.</span></span>
<span></span>
<span><span class="va">osme_cycle_plot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">osme_cycle</span><span class="op">[</span><span class="st">"geometry"</span><span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>To plot an interactive map you have to specify this using <code><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html" class="external-link">tmap_mode()</a></code> function.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html" class="external-link">tmap_mode</a></span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span> <span class="co"># now all the plots will be interactive</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">osme_cycle</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="st">"highway"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Task</strong>:</p>
<ol style="list-style-type: decimal">
<li>Plot an interactive map of a network you defined in the previous task.</li>
<li>Create a <code>tmap</code> object of a static map. Tip: run <code>?tmap_mode()</code> to access function’s documentation.</li>
<li>Bonus: Save your new tmap object. Tip: explore <code><a href="https://rdrr.io/pkg/tmap/man/tmap_save.html" class="external-link">tmap_save()</a></code> function.</li>
</ol>
</div>
<div class="section level2">
<h2 id="openinfra">OpenInfra<a class="anchor" aria-label="anchor" href="#openinfra"></a>
</h2>
<p>In this section we are going to explore OpenInfra package and some of the functions it currently contains.</p>
<p>The <code>openinfra</code> package contains a suite of functions that recategorise OSM data to more meaningful variables for transport planners and policy makers. The aim of the <code>openinfra</code> package is to add value to OSM data so that this may act as better evidence to support transport planners and policy makers.</p>
<p>One of the functions that the package has is <code><a href="../reference/oi_recode_road_class.html">oi_recode_road_class()</a></code>. It recategorises OSM highways based on the Chan and Cooper’s (2019) work in which they propose that road class can be used to infer motor traffic volume. Road traffic volume is an important factor in discouraging cycling.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leeds_high_rec</span> <span class="op">=</span> <span class="va">leeds_defined2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">openinfra</span><span class="fu">::</span><span class="fu"><a href="../reference/oi_recode_road_class.html">oi_recode_road_class</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">leeds_high_rec</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="st">"oi_road_desc"</span><span class="op">)</span></span></code></pre></div>
<p>Another important consideration in the context of cycling is the maxspeed of motor vehicles as lower motor vehicle speed is associated with lower driver-cyclist road crashes.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">leeds_speed_rec</span> <span class="op">=</span> <span class="va">leeds_defined2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">openinfra</span><span class="fu">::</span><span class="fu"><a href="../reference/oi_clean_maxspeed_uk.html">oi_clean_maxspeed_uk</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">leeds_speed_rec</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="st">"oi_maxspeed"</span><span class="op">)</span></span></code></pre></div>
<p>We know that in the UK it recommended to have some kind of segregation (eg. lines, tracks) if maxspeed of a motor vehicle is allowed to exceed 30mph. Therefore, we might want to find out if the existing cycling infrastructure complies with the requirements for roads that have maxspeed of 30mph and over.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note: that this is simplification of an above example and does not take into consideration .</span></span>
<span><span class="va">leeds_seg</span> <span class="op">=</span> <span class="va">leeds_speed_rec</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">oi_maxspeed</span> <span class="op">!=</span> <span class="st">"20 mph"</span> <span class="op">&amp;</span></span>
<span>                                               <span class="va">cycleway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lane"</span>, <span class="st">"track"</span>, <span class="st">"left"</span><span class="op">)</span> <span class="op">|</span></span>
<span>                                               <span class="va">highway</span> <span class="op">==</span> <span class="st">"cycleway"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">leeds_seg</span><span class="op">[</span><span class="st">"geometry"</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Here we have shown outputs from two of the <code>openinfra</code> functions, <code>oi_clean_maxspeed_uk</code> and <code>oi_recode_road_class</code>. The other package functions and their respective documentation can be found <a href="https://udsleeds.github.io/openinfra/reference/index.html" class="external-link">here</a></p>
<p><strong>Task</strong>: Modify the above example, apply to your data, and then plot it. What does it say about the existing cycling infrastructure?</p>
<div class="section level3">
<h3 id="transport-infrastructure-data-packs">Transport Infrastructure Data Packs<a class="anchor" aria-label="anchor" href="#transport-infrastructure-data-packs"></a>
</h3>
<p>The transport infrastructure data packs are created from recategorised OSM data. The OSM data has been recategorised by the OpenInfra functions.</p>
<p>Following this workshop, you should be able to create such infrastructure data packs for your desired area.</p>
<p>Here we will visualise the outputs from several <code>openinfra</code> fucntions.</p>
<div class="section level4">
<h4 id="oi_recode_road_class">oi_recode_road_class()<a class="anchor" aria-label="anchor" href="#oi_recode_road_class"></a>
</h4>
<p>This function recategorises OSM infrastructure data from the default <code>highway=*</code> values to one of the official UK road classifications. <br> With such information, one may wish to <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6928227/" class="external-link">infer traffic flow volumes</a> as a function of road classification.</p>
<iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/2500m_LCC_map_road_desc.html" width="100%" height="650px" data-external="1">
</iframe>
</div>
<div class="section level4">
<h4 id="oi_active_cycle-and-oi_active_walk">oi_active_cycle() and oi_active_walk()<a class="anchor" aria-label="anchor" href="#oi_active_cycle-and-oi_active_walk"></a>
</h4>
<p>The <code>oi_active_cycle</code> and <code>oi_active_walk</code> functions recategorise OSM infrastructure data based on whether or not the feature in question forms part of a usable transport network for cyclists or pedestrians.</p>
<p><strong>oi_active_cycle</strong> <iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/2500m_LCC_map_active_cycle.html" width="100%" height="650px" data-external="1"></iframe></p>
<p><strong>oi_active_walk</strong> <iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/2500m_LCC_map_active_walk.html" width="100%" height="650px" data-external="1"></iframe></p>
</div>
<div class="section level4">
<h4 id="oi_clean_maxspeed_uk">oi_clean_maxspeed_uk()<a class="anchor" aria-label="anchor" href="#oi_clean_maxspeed_uk"></a>
</h4>
<p>This function recategorises default OSM <code>maxspeed</code> values to be compliant with the current official <a href="https://www.gov.uk/speed-limits" class="external-link">UK speed limits</a>. <br></p>
<iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/2500m_LCC_fig_maxspeed.html" width="100%" height="650px" data-external="1">
</iframe>
</div>
<div class="section level4">
<h4 id="oi_is_lit">oi_is_lit()<a class="anchor" aria-label="anchor" href="#oi_is_lit"></a>
</h4>
<p>This functions recategorises default OSM <code>lit</code> values, values that indicate the type and presence of lighting, to either:</p>
<ul>
<li>“yes”,</li>
<li>“no”,</li>
<li>or “maybe”</li>
</ul>
<p>Note that “maybe” does not indicate the lack of lighting, instead, this indicates that there is a lack of data to distinguish between “yes” or “no”. <br> Clearly, in built up urban areas it is likely that there will be lighting. However, in more rural areas and the countryside this is more likely to be “no”. <br> Such information may be valuable if you would like to establish a safe active travel network that is suitable to use after dark.</p>
<iframe src="https://udsleeds.github.io/openinfraresults/tmap/assets/2500m_LCC_fig_is_lit.html" width="100%" height="650px" data-external="1">
</iframe>
</div>
</div>
</div>
<div class="section level2">
<h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>The purpose of this workshop was to get you started. The approach, reading in large datasets into R and modifying/visualising them to support transport planning, is flexible so there are many possible future directions of travel. Below are some suggestions, ranging from easy to hard.</p>
<ol start="4" style="list-style-type: decimal">
<li>Difficult: Run the code in the <a href="https://a-b-street.github.io/abstr/articles/pct_to_abstr.html" class="external-link">“Visualising cycling potential with A/B Street” vignette</a> from the <code>abstr</code> R package to demonstrate R can be used to generate data for dynamic agent-based travel simulation.</li>
</ol>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1">
<p>You can also load all packages at once with:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkgs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pkgs</span>, <span class="st">"osmextract"</span>, <span class="st">"openinfra"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">pkgs</span>, <span class="va">library</span>, character.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<h2 id="section"></h2>
<a href="#fnref1" class="footnote-back">↩︎</a>
</li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Greta Timaite, Robin Lovelace.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
